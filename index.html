<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Application</title>
</head>
<body>
<div id="quiz-container">
    <h1>Quiz Application</h1>
    <div id="question-container">
        <p id="question"></p>
        <form id="choices-form">
            <!-- Choices will be dynamically populated here -->
        </form>
    </div>
    <div id="score-container">
        <p>Score: <span id="score">0</span></p>
    </div>
    <button id="submit-btn">Submit Answer</button>
    <button id="next-btn">Next Question</button>
</div>

<script>
class Question {
    constructor(question, choices, correctAnswer) {
        this.question = question;
        this.choices = choices; // Array of all possible answers
        this.correctAnswer = correctAnswer;
    }

    checkAnswer(answer) {
        return answer === this.correctAnswer;
    }
}

class Quiz {
    constructor(questions) {
        this.questions = questions.map(q => new Question(q.question, q.choices, q.correctAnswer));
        this.currentIndex = 0;
        this.score = 0;
    }

    getCurrentQuestion() {
        return this.questions[this.currentIndex];
    }

    submitAnswer(answer) {
        if (this.getCurrentQuestion().checkAnswer(answer)) {
            this.score++;
            document.getElementById('score').textContent = this.score;
        }
        this.currentIndex++;
    }

    hasEnded() {
        return this.currentIndex === this.questions.length;
    }
}

async function fetchQuestions() {
    // Fetch the questions from an API or define them here
    const response = await fetch('https://opentdb.com/api.php?amount=10&type=multiple');
    const data = await response.json();
    return data.results;
}

async function startQuiz() {
    const fetchedQuestions = await fetchQuestions();
    // Transform fetched questions to match the expected format
    const questions = fetchedQuestions.map(q => ({
        question: q.question,
        choices: [...q.incorrect_answers, q.correct_answer].sort(() => 0.5 - Math.random()), // Mix correct and incorrect answers
        correctAnswer: q.correct_answer
    }));
    const quiz = new Quiz(questions);

    const questionElement = document.getElementById('question');
    const choicesForm = document.getElementById('choices-form');
    const submitBtn = document.getElementById('submit-btn');
    const nextBtn = document.getElementById('next-btn');

    // Initially hide the next button
    nextBtn.style.display = 'none';

    function displayCurrentQuestion() {
        const currentQuestion = quiz.getCurrentQuestion();
        questionElement.innerHTML = decodeEntities(currentQuestion.question);
        console.log(currentQuestion)

        // Clear previous choices
        choicesForm.innerHTML = '';

        // Populate choices
        currentQuestion.choices.forEach(choice => {
            const choiceInput = document.createElement('input');
            choiceInput.type = 'radio';
            choiceInput.name = 'choice';
            choiceInput.id = choice;
            choiceInput.value = choice;
            const choiceLabel = document.createElement('label');
            choiceLabel.setAttribute('for', choice);
            choiceLabel.textContent = decodeEntities(choice);
            choicesForm.appendChild(choiceInput);
            choicesForm.appendChild(choiceLabel);
            choicesForm.appendChild(document.createElement('br'));
        });
    }

    function handleAnswerSubmission() {
        const selectedChoice = document.querySelector('input[name="choice"]:checked');
        if (selectedChoice) {
            quiz.submitAnswer(selectedChoice.value);
            submitBtn.style.display = 'none'; // Hide submit button after answer submission
            nextBtn.style.display = 'block'; // Show next button to proceed
        } else {
            alert('Please select an answer.');
        }
    }

    function moveToNextQuestion() {
        if (!quiz.hasEnded()) {
            displayCurrentQuestion();
            submitBtn.style.display = 'block'; // Show submit button for the new question
            nextBtn.style.display = 'none'; // Hide next button until answer is submitted
        } else {
            questionElement.textContent = 'Quiz ended! Your score: ' + quiz.score;
            choicesForm.innerHTML = '';
            submitBtn.style.display = 'none';
            nextBtn.style.display = 'none';
        }
    }

    submitBtn.addEventListener('click', handleAnswerSubmission);
    nextBtn.addEventListener('click', moveToNextQuestion);

    // Display the first question
    displayCurrentQuestion();
}



function decodeEntities(encodedString) {
    const textArea = document.createElement('textarea');
    textArea.innerHTML = encodedString;
    return textArea.value;
}

// Call startQuiz to run the quiz
startQuiz();
</script>
</body>
</html>
